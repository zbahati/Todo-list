import Task from './Task.js';

const Tasks = {
  tasks: JSON.parse(localStorage.getItem('tasks')) || [],
  storage: localStorage,

  saveData: (storage) => {
    storage.setItem('tasks', JSON.stringify(Tasks.tasks));
  },

  addTask: (description) => {
    const newTask = new Task(description, false, Tasks.tasks.length + 1);
    Tasks.tasks.push(newTask);
    Tasks.saveData(Tasks.storage);
  },

  removeTask: (index) => {
    Tasks.tasks.splice(index, 1);
    Tasks.tasks.forEach((task, index) => {
      task.index = index + 1;
    });
    Tasks.saveData(Tasks.storage);
  },

  editTask: (index, newDescription) => {
    const task = Tasks.tasks[index];
    task.description = newDescription;
    Tasks.saveData(Tasks.storage);
  },

  toggleTaskCompleted: (index) => {
    const task = Tasks.tasks[index];
    task.completed = !task.completed;
    Tasks.saveData(Tasks.storage);
  },

  getSortedTasks: () => Tasks.tasks.sort((a, b) => a.index - b.index),
};

export default Tasks;
